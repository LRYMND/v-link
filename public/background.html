<title>BGTask</title>
<script>
	const { PythonShell } = require('python-shell');
	const { ipcRenderer } = require('electron');
	const path = require('path');


	let pyshell


	ipcRenderer.on('startPython', (event, args) => {
		const scriptPath = path.join(process.resourcesPath, '/scripts/dashboard.py')
		ipcRenderer.send('msgToMain', { message: scriptPath });

		const { data } = args;
		pyshell = new PythonShell(scriptPath, {
			pythonPath: 'python',
			pythonOptions: ['-u'],
			args: [data]
		});

		pyshell.on('message', function (data) {
			//console.log(data)
			ipcRenderer.send('msgToMain', { message: data });
		});
		
		pyshell.on('error', function (error) {
			ipcRenderer.send('msgToMain', { message: error });
		});
		
		pyshell.on('stderr', function (stderr) {
			ipcRenderer.send('msgToMain', { message: stderr });
		});

	});


	ipcRenderer.on('stopPython', (event, args) => {
		console.log('killing python');
		pyshell.kill();
		ipcRenderer.send('backgroundClose');
	});


	ipcRenderer.send('backgroundReady');
</script>
